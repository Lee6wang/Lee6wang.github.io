---
title: "PMSM闭环控制设计详解：PI电流环与速度环设计"
date: 2026-01-28 19:00:00 +0800
categories: [Motor Control, Engineering]
tags: [PMSM]
math: true
---

# PMSM闭环控制设计详解：PI电流环与速度环设计

## 写在前面

> 从本章开始，我们将正式进入电机控制阶段，前面的内容都是铺垫。
> 同时，这里仍然感谢袁雷老师的书。
> 后续的逻辑主要是：原理 → Simulink仿真 → DSP实机验证。
> 至于DSP部分的代码，也许会开源一部分，看后续开发是否顺利啦。
> 如果开源的话，后面会写一期新的（大概率会有，敬请关注）。
---
> 目前传统的矢量控制方法主要有 $i_d=0$ 控制和最大转矩电流比控制。
> 前者用于表贴式三相PMSM，后者用于内置式三相PMSM。
> 对于表贴式三相PMSM，这两种控制方式是等价的。
> 下图为采用 $i_d=0$ 控制方法的三相PMSM矢量控制框图，
> 分为三部分：转速环PI、电流环PI、SVPWM。

![1](../assets/figure/2026-01-28/1.png)

---

## 一、转速环：基于有功阻尼的PI参数整定

对于转速环PI的参数整定方法，通常采用自动控制理论中的**典型II型系统**进行PI参数整定。

考虑到有些朋友可能没有学过自动控制原理这一类的课程，在这里首先讲一下什么是II型系统。

### 1.1 从机械方程到典型II型系统

我们从物理本体出发，PMSM的机械方程为：

$$
J \frac{d\omega_m}{dt} = T_e - T_L - B\omega_m
\tag{1}
$$

其中：$J$ 是等效转动惯量，$\omega_m$ 是机械角速度，$T_e$ 是电磁转矩，$T_L$ 是负载转矩，$B$ 是粘性阻尼系数。

如果我们忽略除 $T_e$ 外的其他扰动，再进行拉氏变换，可以得到：

$$
\omega(s) = \frac{1}{Js} T_e(s)
\tag{2}
$$

对于PI控制器来说，速度误差项等于：

$$
e_\omega = \omega^\ast - \omega
\tag{3}
$$

PI控制器为：

$$
i_q^\ast(s) = K_p e_\omega(s) + \frac{K_i}{s} e_\omega(s)
\tag{4}
$$

将式（2）和（4）相乘可以得到开环传递函数：

$$
L(s) = \frac{K_t (K_p s + K_i)}{J s^2}
\tag{5}
$$

这就是速度环**典型II型系统**。

### 1.2 力矩方程的简化

下面我们回到正题。为了便于转速环PI调节器的参数整定，重写三相PMSM的力矩方程：

$$
T_e = \frac{3}{2} p_n i_q \left[ i_d (L_d - L_q) + \psi_f \right]
\tag{6}
$$

当采用 $i_d=0$ 的控制策略时，可以简化成：

$$
T_e = K_t i_q
\tag{7}
$$

其中：$K_t = \frac{3}{2} p_n \psi_f$

### 1.3 有功阻尼的引入与物理意义

按照袁雷老师书本中所提出的参考文献（*Torque-maximizing field-weakening control: design, analysis and parameter selection*），使用"有功阻尼"的概念对转速环PI调节器进行设计：

$$
i_q = i_q' - B_a \omega_m
\tag{8}
$$

其中：$i_q$ 是实际施加到电机的q轴电流，$i_q'$ 是原本PI速度控制器算出来的电流指令，$B_a$ 是人为设计的"有功阻尼系数"。

为了方便各位读者理解，这里给大家解释一下（不用去看论文）。

先把式（8）代回式（7），可以得到：

$$
T_e = K_t (i_q' - B_a \omega_m) = K_t i_q' - K_t B_a \omega_m
\tag{9}
$$

放回机械方程：

$$
J \dot{\omega}_m = K_t i_q' - T_L - (B + K_t B_a) \omega_m
\tag{10}
$$

对比式（1），可以得出一个新的结论：

$$
B_{\text{等效}} = B + K_t B_a
\tag{11}
$$

这一项是通过算法人为"制造了一个阻尼项"，这个阻尼是通过有功功率（电流做功）实现的，所以叫**有功阻尼**。

**为什么要加有功阻尼？**

**原因一：补足速度环缺失的"能量耗散通道"**

- 传统速度环：主要靠PI零点"形状阻尼"，本体几乎不耗能
- 加有功阻尼后：系统在运动层面就能主动"刹车"，能量不全压在PI调节上

**原因二：将"阻尼设计"从PI参数中解耦出来**

- 传统PI中：$K_p$、$K_i$ 同时影响阻尼、响应速度、稳态误差
- 加有功阻尼后：$B_a$ 主要决定阻尼/超调，PI主要负责带宽和稳态精度

### 1.4 传递函数的推导

现在我们回到公式。当采用 $i_d=0$ 的策略时，并假定电机在空载（$T_L=0$）情况下启动，由式(1)、(6)、(8)可得：

$$
\frac{d\omega_m}{dt} = \frac{1.5 p_n \psi_f}{J}(i_q' - B_a \omega_m) - \frac{B}{J} \omega_m
\tag{12}
$$

上式也可以把阻尼项合并，可以得到下面这个式子：

$$
\frac{d\omega_m}{dt} = \frac{1.5 p_n \psi_f}{J} i_q' - \underbrace{\frac{B + 1.5 p_n \psi_f B_a}{J}}_{\text{等效阻尼}} \omega_m
\tag{13}
$$

对式(13)做拉氏变换，得：

$$
Js \omega_m(s) + (B + 1.5 p_n \psi_f B_a) \omega_m(s) = 1.5 p_n \psi_f i_q'(s)
\tag{14}
$$

整理可得标准形式：

$$
\omega_m(s) = \frac{\dfrac{1.5 p_n \psi_f}{J}}{s + \dfrac{B + 1.5 p_n \psi_f B_a}{J}} i_q'(s)
\tag{15}
$$

如果要让极点等于 $-\beta$，需要：

$$
\frac{B + 1.5 p_n \psi_f B_a}{J} = \beta
\tag{16}
$$

可进一步得到：

$$
B_a = \frac{\beta J - B}{1.5 p_n \psi_f}
\tag{17}
$$

### 1.5 闭环系统设计

根据传统的PI调节器，转速环控制器的表达式为：

$$
i_q^\ast = \left( K_{p\omega} + \frac{K_{i\omega}}{s} \right) \underbrace{(\omega_m^\ast - \omega_m)}_{\text{速度误差}} - B_a \omega_m
\tag{18}
$$

假设电流环足够快，可以认为 $i_q = i_q^\ast$，结合式(8)可得：

$$
i_q' = i_q + B_a \omega_m = i_q^\ast + B_a \omega_m
\tag{19}
$$

代入控制器方程(18)可得：

$$
i_q' = \left( K_{p\omega} + \frac{K_{i\omega}}{s} \right) (\omega_m^\ast - \omega_m)
\tag{20}
$$

由公式(15)可以得到其传递函数为：

$$
\frac{\omega_m(s)}{i_q'(s)} = \frac{\dfrac{1.5 p_n \psi_f}{J}}{s + \beta}
\tag{21}
$$

为了简化计算，定义：

$$
K_m = \frac{1.5 p_n \psi_f}{J}
\tag{22}
$$

所以可以列出：

$$
\frac{\omega_m(s)}{i_q'(s)} = \frac{K_m}{s + \beta}
\tag{23}
$$

将式(20)改写为如下形式：

$$
i_q' = \left( \frac{K_{p\omega} s + K_{i\omega}}{s} \right) (\omega_m^\ast - \omega_m)
\tag{24}
$$

在这里可以简单确定一下系统的结构，如下图所示：

![2](../assets/figure/2026-01-28/2.png)

根据式(23)和式(24)可以列出：

**PI控制器：**

$$
G_c(s) = \frac{K_{p\omega} s + K_{i\omega}}{s}
\tag{25}
$$

**被控对象：**

$$
G_p(s) = \frac{K_m}{s + \beta}
\tag{26}
$$

可得出其闭环传递函数公式为：

$$
\frac{\omega_m(s)}{\omega_m^\ast(s)} = \frac{G_c(s) G_p(s)}{1 + G_c(s) G_p(s)}
\tag{27}
$$

计算并化简可以得到结果：

$$
\frac{\omega_m(s)}{\omega_m^\ast(s)} = \frac{K_m (K_{p\omega} s + K_{i\omega})}{s^2 + (\beta + K_m K_{p\omega}) s + K_m K_{i\omega}}
\tag{28}
$$

### 1.6 零极点对消与参数计算

为了让系统表现为一个带宽为 $\beta$ 的一阶系统，即：

$$
\frac{\omega_m(s)}{\omega_m^\ast(s)} = \frac{\beta}{s + \beta}
\tag{29}
$$

这里我们选择**零极点对消**，使得分子的零点与分母的一个极点对消，系统就变成一阶系统了。

让分母可以因式分解为：

$$
s^2 + (\beta + K_m K_{p\omega}) s + K_m K_{i\omega} = (s + \beta)(s + K_m K_{p\omega})
\tag{30}
$$

展开右边可得：

$$
(s + \beta)(s + K_m K_{p\omega}) = s^2 + (\beta + K_m K_{p\omega}) s + \beta K_m K_{p\omega}
\tag{31}
$$

对比常数项：

$$
K_{i\omega} = \beta K_{p\omega}
\tag{32}
$$

**验证零极点对消：**

分子为：

$$
K_m K_{p\omega} s + K_m K_{i\omega} = K_m K_{p\omega} \left( s + \frac{K_{i\omega}}{K_{p\omega}} \right) = K_m K_{p\omega} (s + \beta)
\tag{33}
$$

分母为：

$$
(s + \beta)(s + K_m K_{p\omega})
\tag{34}
$$

整理可得：

$$
\frac{\omega_m(s)}{\omega_m^\ast(s)} = \frac{K_m K_{p\omega} (s + \beta)}{(s + \beta)(s + K_m K_{p\omega})} = \frac{K_m K_{p\omega}}{s + K_m K_{p\omega}}
\tag{35}
$$

我们希望闭环带宽为 $\beta$，即：

$$
K_m K_{p\omega} = \beta
\tag{36}
$$

**最终参数公式：**

计算 $K_{p\omega}$：

$$
K_{p\omega} = \frac{\beta}{K_m} = \frac{\beta}{\dfrac{1.5 p_n \psi_f}{J}} = \frac{\beta J}{1.5 p_n \psi_f}
\tag{37}
$$

计算 $K_{i\omega}$：

$$
K_{i\omega} = \beta K_{p\omega} = \frac{\beta^2 J}{1.5 p_n \psi_f}
\tag{38}
$$

---

## 二、电流环：基于内模控制的PI参数整定

### 2.1 d-q坐标系下的电流方程

为了便于控制器的设计，重写 $d$-$q$ 坐标系下的电流方程为：

$$
\begin{cases}
\dfrac{d i_d}{dt} = -\dfrac{R}{L_d} i_d + \dfrac{L_q}{L_d} \omega_e i_q + \dfrac{1}{L_d} u_d \\[8pt]
\dfrac{d i_q}{dt} = -\dfrac{R}{L_q} i_q - \dfrac{1}{L_q} \omega_e (L_d i_d + \psi_f) + \dfrac{1}{L_q} u_q
\end{cases}
\tag{39}
$$

从式(39)可以看出，定子电流 $i_d$、$i_q$ 分别在 $d$、$q$ 轴方向产生**交叉耦合电动势**，这对于控制是非常困难的。

### 2.2 电压方程与耦合项分析

这里为了便于记忆，我们先给出 $u_d$ 和 $u_q$ 的公式：

$$
\begin{cases}
u_d = R i_d + L_d \dfrac{d i_d}{dt} - \omega_e L_q i_q \\[10pt]
u_q = R i_q + L_q \dfrac{d i_q}{dt} + \omega_e (L_d i_d + \psi_f)
\end{cases}
\tag{40}
$$

对于耦合项来说，其物理意义如下：

> - $\omega_e L_q i_q$：q轴电流在旋转时产生的感应电动势，影响d轴
> - $\omega_e (L_d i_d + \psi_f)$：d轴磁链在旋转时产生的反电动势，影响q轴

这些耦合项使得d轴和q轴相互影响，无法独立控制。

### 2.3 前馈解耦及其局限性

若将其完全解耦，即加上后面的耦合项，式(40)可变为：

$$
\begin{cases}
u_{d0} = u_d + \omega_e L_q i_q = R i_d + L_d \dfrac{d i_d}{dt} \\[8pt]
u_{q0} = u_q - \omega_e (L_d i_d + \psi_f) = R i_q + L_q \dfrac{d i_q}{dt}
\end{cases}
\tag{41}
$$

其中：$u_{d0}$ 和 $u_{q0}$ 分别为电流解耦后的 $d$ 轴和 $q$ 轴电压。

解耦后，每个轴变成独立的一阶RL电路，可以独立设计。

将式(41)进行拉氏变换可得：

$$
Y(s) = G(s) U(s)
\tag{42}
$$

其中：

$$
U(s) = \begin{bmatrix} u_{d0}(s) \\ u_{q0}(s) \end{bmatrix}, \quad
Y(s) = \begin{bmatrix} i_d(s) \\ i_q(s) \end{bmatrix}, \quad
G(s) = \begin{bmatrix} R + sL_d & 0 \\ 0 & R + sL_q \end{bmatrix}^{-1}
$$

这里 $G(s)$ 为对角矩阵，说明 $d$-$q$ 已经完全解耦。单轴的传递函数为：

$$
\begin{cases}
G_d(s) = \dfrac{I_d(s)}{U_{d0}(s)} = \dfrac{1}{R + sL_d} = \dfrac{1/R}{1 + s\tau_d} \\[10pt]
G_q(s) = \dfrac{I_q(s)}{U_{q0}(s)} = \dfrac{1}{R + sL_q} = \dfrac{1/R}{1 + s\tau_q}
\end{cases}
\tag{43}
$$

其中 $\tau_d = L_d/R$，$\tau_q = L_q/R$ 为电气时间常数。

采用常规的PI调节器并结合前馈解耦控制策略，可得到 $d$-$q$ 轴的电压为：

$$
\begin{cases}
u_d^\ast = \underbrace{\left( K_{pd} + \dfrac{K_{id}}{s} \right) (i_d^\ast - i_d)}_{\text{PI控制器}} - \underbrace{\omega_e L_q i_q}_{\text{前馈解耦}} \\[12pt]
u_q^\ast = \underbrace{\left( K_{pq} + \dfrac{K_{iq}}{s} \right) (i_q^\ast - i_q)}_{\text{PI控制器}} + \underbrace{\omega_e (L_d i_d + \psi_f)}_{\text{前馈解耦}}
\end{cases}
\tag{44}
$$

**前馈解耦的局限性：**

如果只使用前馈解耦控制，会存在以下几个问题：

- 解耦项依赖于电机参数
- 只有当模型参数与实际参数完全匹配时，才能实现完全解耦
- 实际中，内置式PMSM存在磁饱和、温度变化等因素，参数会变化
- 参数失配时，解耦不完全，控制性能下降

所以在这里我们还需要引入**内模控制（Internal Model Control, IMC）**。

### 2.4 内模控制原理

针对内模控制，我们可以先做一个类比：

> 想象我们在开车，想要保持恒定速度：
>
> **传统反馈控制：**
> - 你看速度表，发现速度低了就踩油门，高了就松油门
> - 只根据"误差"来调整
>
> **内模控制：**
> - 你脑中有一个"车辆模型"，知道踩多少油门会产生多少加速度
> - 你先根据这个模型计算需要的油门量
> - 然后观察实际速度与模型预测的差异，用这个差异来修正

内模控制的核心是利用对被控对象的"认知"（模型）来改善控制效果。

**内模控制的特点：**

- 对模型精度要求低
- 对参数变化不敏感（鲁棒性好）
- 结构简单，只有一个可调参数 $\alpha$
- 便于在线计算

**内模控制的基本结构：**

![3](../assets/figure/2026-01-28/3.png)

其中，$\hat{G}(s)$ 为内模，$G(s)$ 为被控对象，$C(s)$ 为内模控制器，$U(s)$ 为控制器输出（如电压等），$Y(s)$ 为系统输出。

**两种极端情况分析：**

**情况一：模型完全精确**

此时控制器输入就是本身，反馈通道一直为0，闭环传递函数变成：

$$
\frac{Y(s)}{R(s)} = G(s) C(s)
\tag{45}
$$

相当于一个完全的开环控制，输出完全由 $G(s)C(s)$ 决定。

**情况二：模型完全不准确**

内模完全错误，如 $\hat{G}(s) = 0$ 时，反馈信号没有经过任何改变，系统变成传统的负反馈控制。

在一般情况下，系统模型总是会有一定的误差，于是就可以通过内模控制来进行修正，结合前馈和反馈的两种优点。

### 2.5 内模控制器的设计

可以将上图进行适当的等效变换，得到下图：

![4](../assets/figure/2026-01-28/4.png)

其等效控制器为：

$$
F(s) = \left[ I - C(s) G(s) \right]^{-1} C(s)
\tag{46}
$$

如果我们想要闭环传递函数为我们所期望的 $G_c(s)$：

$$
G_c(s) = G(s) C(s)
\tag{47}
$$

则：

$$
C(s) = G^{-1} G_c(s)
\tag{48}
$$

但是我们知道，取逆可能不存在；如果是非正则（分子阶数 > 分母阶数），在物理上是无法实现的，同时也会出现不稳定的情况。

**引入低通滤波器：**

为了使控制器可实现，引入低通滤波器 $L(s)$：

$$
C(s) = \hat{G}^{-1}(s) L(s)
\tag{49}
$$

其中：$L(s) = \dfrac{\alpha}{s + \alpha}$

它的作用主要如下：

- 使控制器正则（可实现）
- 限制高频增益，减小噪声影响
- 提供一个可调参数 $\alpha$

当 $\hat{G}^{-1} = G(s)$ 时：

$$
G_c(s) = G(s) C(s) = G(s) G^{-1}(s) L(s) = L(s) = \frac{\alpha}{s + \alpha}
\tag{50}
$$

闭环系统变成一阶系统。

### 2.6 电流环PI参数推导

回到式(43)，可以写出 $d$ 轴的内模控制器：

$$
C(s) = \hat{G}^{-1}(s) L(s) = (R + sL_d) \frac{\alpha}{s + \alpha}
\tag{51}
$$

这时再代回式(46)：

$$
C(s) \hat{G}(s) = (R + sL_d) \cdot \frac{\alpha}{s + \alpha} \cdot \frac{1}{R + sL_d} = \frac{\alpha}{s + \alpha}
\tag{52}
$$

$$
I - C(s) \hat{G}(s) = 1 - \frac{\alpha}{s + \alpha} = \frac{s}{s + \alpha}
\tag{53}
$$

$$
\left[ I - C(s) \hat{G}(s) \right]^{-1} = \frac{s + \alpha}{s}
\tag{54}
$$

$$
F(s) = \frac{s + \alpha}{s} \cdot (R + sL_d) \cdot \frac{\alpha}{s + \alpha} = \frac{\alpha(R + sL_d)}{s}
\tag{55}
$$

$$
F(s) = \alpha L_d + \frac{\alpha R}{s} = K_p + \frac{K_i}{s}
\tag{56}
$$

同理，可以计算出q轴对应的 $K_p$、$K_i$：

$$
\begin{cases}
K_{pd} = \alpha L_d \\
K_{id} = \alpha R \\
K_{pq} = \alpha L_q \\
K_{iq} = \alpha R
\end{cases}
\tag{57}
$$

### 2.7 带宽参数α的约束

我们会发现，$\alpha$ 这么好，增大效果也太棒了，那是不是可以无限增大？实则不然，存在如下的限制：

电气时间常数 $T_d = L_d/R$ 表示：

- 在恒定电压下，电流从0上升到稳态值的63.2%所需时间
- 这是电机的固有特性，无法通过控制器改变

$\alpha$ 显然无法超过由时间常数确立的电流变化率，于是产生了如下的约束条件：

$$
\alpha < \frac{1}{T_d} = \frac{R}{L_d}
\tag{58}
$$

---

## 三、总结

当 PI 电流环与速度环完成设计之后，矢量控制才算真正“站稳了地基”。但在实际工程中，这套基于理想模型的控制结构仍然会不断面临挑战：参数漂移、磁饱和、逆变器非线性、采样与计算延迟，都会在更高转速、更大负载和更复杂工况下逐步显现出来。

后续也依然有很多工作需要做，但希望我们可以一起成长，回答一个更重要的问题：**当控制对象不再理想时，我们应当如何重新理解和设计电机控制系统。**

**Make It Work! Make It Better!**
